<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√úr√ºn Detayƒ± - STYLE</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/chat.css">
    <style>
        /* Specific Detail Page Styles */
        .product-detail-page {
            padding-top: 40px;
            padding-bottom: 80px;
        }

        .breadcrumb {
            margin-bottom: 30px;
            font-size: 14px;
            color: #666;
        }

        .breadcrumb a {
            color: #666;
            text-decoration: none;
        }

        .breadcrumb span {
            color: #000;
            font-weight: 500;
        }

        .product-detail-container {
            display: grid;
            grid-template-columns: 1.5fr 1fr;
            gap: 60px;
        }

        .product-gallery {
            display: flex;
            gap: 20px;
        }

        .thumbnail-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .thumbnail {
            width: 80px;
            height: 100px;
            cursor: pointer;
            border: 1px solid transparent;
            transition: all 0.2s;
        }

        .thumbnail.active {
            border-color: #000;
        }

        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .main-image {
            flex: 1;
            height: 700px;
            background-color: #f5f5f5;
        }

        .main-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-info-detail {
            padding-top: 10px;
        }

        .product-title-large {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 15px;
            line-height: 1.2;
        }

        .product-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
        }

        .rating {
            color: #ffc107;
            font-size: 18px;
        }

        .review-count {
            color: #666;
            font-size: 14px;
            margin-left: 5px;
        }

        .sku {
            font-size: 12px;
            color: #999;
        }

        .price-section {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .current-price-large {
            font-size: 36px;
            font-weight: 700;
        }

        .old-price-large {
            font-size: 24px;
            color: #999;
            text-decoration: line-through;
        }

        .discount-tag {
            background-color: #dc143c;
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            font-weight: 700;
            font-size: 14px;
        }

        .product-description-short {
            font-size: 16px;
            color: #444;
            line-height: 1.6;
            margin-bottom: 30px;
            border-bottom: 1px solid #eee;
            padding-bottom: 30px;
        }

        .option-group {
            margin-bottom: 25px;
        }

        .option-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 14px;
        }

        .selected-option {
            font-weight: 400;
            color: #666;
        }

        .color-options-large {
            display: flex;
            gap: 15px;
        }

        .color-option-large {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: transform 0.2s;
        }

        .color-option-large.selected {
            border-color: #000;
            transform: scale(1.1);
        }

        .size-options-large {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .size-btn-large {
            width: 50px;
            height: 50px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .size-btn-large:hover, .size-btn-large.selected {
            background: #000;
            color: white;
            border-color: #000;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 40px;
        }

        .quantity-selector-large {
            display: flex;
            border: 1px solid #ddd;
            height: 56px;
        }

        .qty-btn-large {
            width: 40px;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
        }

        .qty-input-large {
            width: 50px;
            border: none;
            text-align: center;
            font-size: 16px;
            font-weight: 600;
        }

        .add-to-cart-btn-large {
            flex: 1;
            background-color: #000;
            color: white;
            border: none;
            font-size: 16px;
            font-weight: 700;
            letter-spacing: 1px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .add-to-cart-btn-large:hover {
            background-color: #333;
        }

        .wishlist-btn-large {
            width: 56px;
            background: white;
            border: 1px solid #ddd;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .wishlist-btn-large:hover {
            border-color: #000;
        }

        .product-features-list {
            margin-top: 40px;
            display: flex;
            justify-content: space-between;
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
        }

        .feature-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #333;
            text-align: center;
        }

        .feature-icon {
            font-size: 24px;
        }

        .product-extra-info {
            margin-top: 30px;
        }

        .info-item {
            border-bottom: 1px solid #eee;
        }

        .info-header {
            padding: 15px 0;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
        }

        .similar-products-section {
            padding-top: 60px;
            border-top: 1px solid #eee;
            margin-top: 60px;
        }
        
        .section-heading {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 40px;
            text-align: center;
            text-transform: uppercase;
        }

        @media (max-width: 992px) {
            .product-detail-container {
                grid-template-columns: 1fr;
            }
            .product-gallery {
                flex-direction: column-reverse;
            }
            .thumbnail-list {
                flex-direction: row;
            }
            .main-image {
                height: 400px;
            }
        }
        /* Try On Button */
        .try-on-btn-large {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background-color: #fff;
            color: #000;
            border: 1px solid #000;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            padding: 0 15px;
            height: 56px; /* Match height of other input/buttons */
        }

        .try-on-btn-large:hover {
            background-color: #f5f5f5;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .try-on-modal {
            background: white;
            width: 90%;
            max-width: 480px;
            border-radius: 16px;
            padding: 40px;
            position: relative;
            transform: translateY(20px);
            transition: transform 0.3s ease;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        }

        .modal-overlay.active .try-on-modal {
            transform: translateY(0);
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 28px;
            color: #666;
            line-height: 1;
        }

        .modal-header-icon {
            font-size: 40px;
            margin-bottom: 20px;
            display: block;
            text-align: center;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 10px;
            text-align: center;
            color: #000;
        }

        .modal-subtitle {
            text-align: center;
            color: #666;
            font-size: 15px;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .try-on-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .try-on-option-btn {
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 25px 15px;
            background: #fcfcfc;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .try-on-option-btn:hover {
            border-color: #000;
            background: #fff;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .option-icon {
            font-size: 32px;
        }

        .option-text {
            font-weight: 600;
            font-size: 14px;
            color: #333;
        }

        .privacy-note {
            margin-top: 25px;
            font-size: 12px;
            color: #999;
            text-align: center;
            border-top: 1px solid #f0f0f0;
            padding-top: 20px;
        }

    </style>
    <style>
        /* New VTON Styles */
        .preview-container {
            width: 100%;
            height: 300px;
            background: #f5f5f5;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .preview-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: space-between;
        }

        .primary-btn {
            flex: 1;
            background: #000;
            color: #fff;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .primary-btn:hover { opacity: 0.9; }

        .secondary-btn {
            flex: 1;
            background: #fff;
            color: #000;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }
        .secondary-btn:hover { border-color: #000; }

        /* Loader */
        .ai-loader {
            width: 48px;
            height: 48px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #000;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .process-text {
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 5px;
        }

        .process-subtext {
            color: #666;
            font-size: 14px;
        }

        /* Result */
        .result-wrapper {
            position: relative;
            width: 100%;
            height: 350px;
            background: #eee;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .result-bg {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .result-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60%;
            opacity: 0.95;
            mix-blend-mode: multiply; /* Gives a slight 'blended' look */
        }
    </style>
</head>
<body>
    <header class="header">
      <div class="container">
        <div class="header-content">
          <a href="index.html" class="logo" style="text-decoration: none; color: black">STYLE</a>
          <nav class="nav">
            <a href="kadin.html" class="nav-link">Kadƒ±n</a>
            <a href="erkek.html" class="nav-link">Erkek</a>
            <a href="cocuk.html" class="nav-link">√áocuk</a>
            <a href="yeni-sezon.html" class="nav-link">Yeni Sezon</a>
            <a href="indirim.html" class="nav-link">ƒ∞ndirim</a>
          </nav>
        </div>
      </div>
    </header>

    <div class="product-detail-page">
        <div class="container">
            <!-- Breadcrumb -->
            <div class="breadcrumb" id="breadcrumb">
                <a href="index.html">Anasayfa</a> / <a href="#" id="breadcrumb-category">Kategori</a> / <span id="breadcrumb-name">√úr√ºn</span>
            </div>
    
            <div class="product-detail-container">
                <!-- Left: Gallery -->
                <div class="product-gallery">
                    <div class="thumbnail-list" id="thumbnails">
                        <!-- Thumbs JS -->
                    </div>
                    <div class="main-image">
                        <img id="main-product-image" src="" alt="Product Image">
                    </div>
                </div>
    
                <!-- Right: Info -->
                <div class="product-info-detail">
                    <h1 class="product-title-large" id="product-name">Loading...</h1>
                    <div class="product-meta">
                        <div class="rating">
                            ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ <span class="review-count" id="review-count">(0 Deƒüerlendirme)</span>
                        </div>
                        <span class="sku">STOK KODU: #883921</span>
                    </div>
                    
                    <div class="price-section">
                        <span class="current-price-large" id="product-price"></span>
                        <span class="old-price-large" id="product-old-price"></span>
                        <span class="discount-tag" id="product-discount" style="display: none;"></span>
                    </div>
    
                    <div class="product-description-short" id="product-description"></div>
    
                    <!-- Color Selection -->
                    <div class="option-group" id="color-section">
                        <label>Renk: <span class="selected-option" id="selected-color-name">Se√ßiniz</span></label>
                        <div class="color-options-large" id="color-options"></div>
                    </div>
    
                    <!-- Size Selection -->
                    <div class="option-group" id="size-section">
                        <div class="size-header" style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <label style="margin:0;">Beden: <span class="selected-option" id="selected-size-name">Se√ßiniz</span></label>
                            <a href="#" class="size-guide" style="font-size: 14px; text-decoration: underline; color: #666;">Beden Tablosu</a>
                        </div>
                        <div class="size-options-large" id="size-options"></div>
                    </div>
    
                    <!-- Actions -->
                    <div class="action-buttons">
                        <div class="quantity-selector-large">
                            <button class="qty-btn-large">-</button>
                            <input type="text" value="1" class="qty-input-large">
                            <button class="qty-btn-large">+</button>
                        </div>
                        <button class="add-to-cart-btn-large">SEPETE EKLE</button>
                        <button class="try-on-btn-large" id="try-on-trigger">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                                <circle cx="12" cy="13" r="4"></circle>
                            </svg>
                            √úZERƒ∞MDE G√ñR
                        </button>
                        <button class="wishlist-btn-large">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                        </button>
                    </div>
    
                    <!-- Features List -->
                    <div class="product-features-list">
                        <div class="feature-item">
                            <span class="feature-icon">üöö</span>
                            <span>√úcretsiz Kargo</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">‚Ü©Ô∏è</span>
                            <span>30 G√ºn ƒ∞ade</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">üîí</span>
                            <span>G√ºvenli √ñdeme</span>
                        </div>
                    </div>
    
                    <!-- Extra Info -->
                    <div class="product-extra-info">
                         <div class="info-item">
                            <div class="info-header" onclick="this.nextElementSibling.style.display = this.nextElementSibling.style.display === 'none' ? 'block' : 'none'">
                                √úr√ºn Detaylarƒ± <span class="toggle-icon">+</span>
                            </div>
                              <div class="info-content" style="display: block; padding-bottom: 15px; color: #666; font-size: 14px;">
                                <p id="product-long-desc"></p>
                              </div>
                         </div>
                    </div>
                </div>
            </div>
            
            <!-- Similar Products -->
            <div class="similar-products-section">
                <h2 class="section-heading">Benzer √úr√ºnler</h2>
                <div class="products-grid" id="similar-products-grid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 30px;">
                    <!-- JS Injected -->
                </div>
            </div>

        </div>
    </div>
    
    <!-- Try On Modal -->
    <div class="modal-overlay" id="try-on-modal">
        <div class="try-on-modal">
            <button class="modal-close" id="close-modal">&times;</button>
            <span class="modal-header-icon">‚ú®</span>
            <h2 class="modal-title">Sanal Deneme Kabini</h2>
            
            <!-- Step 1: Selection -->
            <div id="step-select">
                <p class="modal-subtitle">Yapay zeka teknolojisi ile bu √ºr√ºn√º √ºzerinizde g√∂r√ºn. Ba≈ülamak i√ßin bir y√∂ntem se√ßin.</p>
                <div class="try-on-options">
                    <button class="try-on-option-btn" onclick="alert('Kamera √∂zelliƒüi tarayƒ±cƒ± izinleri gerektirir. L√ºtfen fotoƒüraf y√ºkleme se√ßeneƒüini kullanƒ±n.')">
                        <span class="option-icon">üì∏</span>
                        <span class="option-text">Kamerayƒ± A√ß</span>
                    </button>
                    <button class="try-on-option-btn" id="vton-upload-btn">
                        <span class="option-icon">üñºÔ∏è</span>
                        <span class="option-text">Fotoƒüraf Y√ºkle</span>
                    </button>
                    <input type="file" id="vton-file-input" accept="image/*" style="display: none;">
                </div>
                <p class="privacy-note">üîí Gizliliƒüiniz bizim i√ßin √∂nemlidir. Fotoƒüraflarƒ±nƒ±z i≈ülendikten hemen sonra silinir.</p>
            </div>

            <!-- Step 2: Preview -->
            <div id="step-preview" style="display: none;">
                <p class="modal-subtitle">Se√ßilen fotoƒüraf uygun mu?</p>
                <div class="preview-container">
                    <img id="user-preview-img" src="" alt="M√º≈üteri √ñnizleme">
                </div>
                <div class="modal-actions">
                    <button class="secondary-btn restart-vton">Farklƒ± Fotoƒüraf Se√ß</button>
                    <button class="primary-btn" id="generate-btn">Kombini Olu≈ütur ‚ú®</button>
                </div>
            </div>

            <!-- Step 3: Processing -->
            <div id="step-process" style="display: none; flex-direction: column; align-items: center; padding: 20px 0;">
                <div class="ai-loader"></div>
                <p class="process-text">Yapay Zeka G√∂r√ºnt√ºy√º ƒ∞≈üliyor...</p>
                <p class="process-subtext">L√ºtfen bekleyin, tarzƒ±nƒ±z hazƒ±rlanƒ±yor.</p>
            </div>

            <!-- Step 4: Result -->
            <div id="step-result" style="display: none;">
                <p class="modal-subtitle">ƒ∞≈üte yeni tarzƒ±nƒ±z!</p>
                <div class="result-container">
                    <!-- Overlay logic simulated -->
                    <div class="result-wrapper">
                         <img id="result-user-img" src="" class="result-bg">
                         <img id="result-product-img" src="" class="result-overlay">
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="secondary-btn restart-vton">Tekrar Dene</button>
                    <button class="primary-btn" onclick="document.querySelector('.add-to-cart-btn-large').click(); document.getElementById('close-modal').click();">Sepete Ekle</button>
                </div>
            </div>

        </div>
    </div>
    
    <footer class="footer">
        <div class="container" style="color: white; padding: 40px 0; text-align: center;">
            <p>¬© 2025 STYLE</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Helper to get query param
            const getQueryParam = (name) => {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(name);
            };

            const productId = parseInt(getQueryParam('id')) || 1; // Default to 1 if no ID

            try {
                const response = await fetch('products.json');
                const products = await response.json();
                const product = products.find(p => p.id === productId);

                if (!product) {
                    document.querySelector('.product-detail-container').innerHTML = '<h2>√úr√ºn bulunamadƒ±.</h2>';
                    return;
                }

                // Populate Data
                document.title = `${product.name} - STYLE`;
                document.getElementById('breadcrumb-category').textContent = product.category;
                document.getElementById('breadcrumb-name').textContent = product.name;
                
                document.getElementById('product-name').textContent = product.name;
                document.getElementById('review-count').textContent = `(${product.reviewCount || 0} Deƒüerlendirme)`;
                
                document.getElementById('product-price').textContent = `${product.price} TL`;
                if(product.oldPrice) {
                    document.getElementById('product-old-price').textContent = `${product.oldPrice} TL`;
                }
                if(product.discount) {
                    const discountTag = document.getElementById('product-discount');
                    discountTag.textContent = product.discount;
                    discountTag.style.display = 'inline-block';
                }

                document.getElementById('product-description').textContent = product.shortDescription;
                document.getElementById('product-long-desc').textContent = product.description;

                // Images
                const mainImg = document.getElementById('main-product-image');
                if(product.images && product.images.length > 0) {
                    mainImg.src = product.images[0];
                    
                    const thumbContainer = document.getElementById('thumbnails');
                    product.images.forEach((img, index) => {
                        const thumb = document.createElement('div');
                        thumb.className = `thumbnail ${index === 0 ? 'active' : ''}`;
                        thumb.innerHTML = `<img src="${img}" alt="Thumbnail">`;
                        thumb.onclick = () => {
                            mainImg.src = img;
                            document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
                            thumb.classList.add('active');
                        };
                        thumbContainer.appendChild(thumb);
                    });
                }

                // Colors
                if(product.colors) {
                    const colorContainer = document.getElementById('color-options');
                    product.colors.forEach((color, index) => {
                        const btn = document.createElement('div');
                        btn.className = `color-option-large ${index === 0 ? 'selected' : ''}`;
                        btn.style.backgroundColor = color.hex;
                        if(index === 0) document.getElementById('selected-color-name').textContent = color.name;
                        
                        btn.onclick = () => {
                            document.querySelectorAll('.color-option-large').forEach(b => b.classList.remove('selected'));
                            btn.classList.add('selected');
                            document.getElementById('selected-color-name').textContent = color.name;
                        };
                        colorContainer.appendChild(btn);
                    });
                }

                // Sizes
                if(product.sizes) {
                    const sizeContainer = document.getElementById('size-options');
                    product.sizes.forEach((size, index) => {
                        const btn = document.createElement('button');
                        btn.className = 'size-btn-large';
                        btn.textContent = size;
                        
                        btn.onclick = () => {
                            document.querySelectorAll('.size-btn-large').forEach(b => b.classList.remove('selected'));
                            btn.classList.add('selected');
                            document.getElementById('selected-size-name').textContent = size;
                        };
                        sizeContainer.appendChild(btn);
                    });
                }

                // Similar Products (Same category, exclude current)
                const similarProducts = products.filter(p => p.category === product.category && p.id !== product.id).slice(0, 4);
                const similarGrid = document.getElementById('similar-products-grid');
                
                if(similarProducts.length > 0) {
                    similarGrid.innerHTML = similarProducts.map(p => `
                        <div class="product-card" onclick="window.location.href='urun-detay.html?id=${p.id}'">
                            <div class="product-image-wrapper">
                                <div class="product-image" style="background-image: url('${p.images[0]}')"></div>
                                ${p.discount ? `<span class="discount-badge">${p.discount}</span>` : ''}
                            </div>
                            <div class="product-info">
                                <h3 class="product-name">${p.name}</h3>
                                <div class="product-pricing">
                                    <span class="current-price">${p.price} TL</span>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                     document.querySelector('.similar-products-section').style.display = 'none';
                }

            } catch (error) {
                console.error('Error:', error);
            }


            // Modal Logic
            const modal = document.getElementById('try-on-modal');
            const btn = document.getElementById('try-on-trigger');
            const close = document.getElementById('close-modal');
            const fileInput = document.getElementById('vton-file-input');
            const uploadBtn = document.getElementById('vton-upload-btn');
            
            // Containers
            const stepSelect = document.getElementById('step-select');
            const stepPreview = document.getElementById('step-preview');
            const stepProcess = document.getElementById('step-process');
            const stepResult = document.getElementById('step-result');
            
            // Elements
            const previewImg = document.getElementById('user-preview-img');
            const resultUserImg = document.getElementById('result-user-img');
            const resultProductImg = document.getElementById('result-product-img');
            const generateBtn = document.getElementById('generate-btn');
            const restartBtns = document.querySelectorAll('.restart-vton');

            // Reset Modal State
            const resetModal = () => {
                stepSelect.style.display = 'block';
                stepPreview.style.display = 'none';
                stepProcess.style.display = 'none';
                stepResult.style.display = 'none';
                fileInput.value = '';
                previewImg.src = '';
            };

            if(btn && modal && close) {
                btn.onclick = () => {
                    modal.classList.add('active');
                    resetModal();
                };
                close.onclick = () => modal.classList.remove('active');
                modal.onclick = (e) => {
                    if(e.target === modal) modal.classList.remove('active');
                };
            }

            // File Upload Handler
            if(uploadBtn && fileInput) {
                uploadBtn.onclick = () => fileInput.click();
                
                fileInput.onchange = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            previewImg.src = e.target.result;
                            // Switch to Preview Step
                            stepSelect.style.display = 'none';
                            stepPreview.style.display = 'block';
                        }
                        reader.readAsDataURL(file);
                    }
                };
            }

            // Generate Handler
            if(generateBtn) {
                generateBtn.onclick = () => {
                    // Switch to Process Step
                    stepPreview.style.display = 'none';
                    stepProcess.style.display = 'flex';
                    
                    // Simulate AI Delay
                    setTimeout(() => {
                        stepProcess.style.display = 'none';
                        stepResult.style.display = 'block';
                        
                        // Set result images
                        resultUserImg.src = previewImg.src;
                        // Product image is already set in main page logic, we can grab it from there
                        const mainCurrentImg = document.getElementById('main-product-image').src;
                        resultProductImg.src = mainCurrentImg;
                        
                    }, 3000);
                };
            }

            // Restart Handler
            restartBtns.forEach(btn => {
                btn.onclick = resetModal;
            });
        });

    </script>
    <!-- Chat Widget HTML -->
    <div class="chat-widget-fab" id="chat-fab">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
        </svg>
    </div>

    <div class="chat-window" id="chat-window">
        <div class="chat-header">
            <div class="chat-title">
                <span class="chat-status-dot"></span>
                Destek Asistanƒ±
            </div>
            <button class="chat-close-btn" id="chat-close">&times;</button>
        </div>
        <div class="chat-body" id="chat-body">
            <div class="chat-message message-bot">
                Merhaba! üëã<br>√úr√ºn hakkƒ±nda sorunuz mu var?
                <span class="message-time">≈ûimdi</span>
            </div>
        </div>
        <div class="chat-input-area">
            <input type="text" class="chat-input" id="chat-input" placeholder="Mesajƒ±nƒ±zƒ± yazƒ±n...">
            <button class="chat-send-btn" id="chat-send">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
            </button>
        </div>
    </div>

    <!-- Chat Logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const fab = document.getElementById('chat-fab');
            const window = document.getElementById('chat-window');
            const closeBtn = document.getElementById('chat-close');
            const input = document.getElementById('chat-input');
            const sendBtn = document.getElementById('chat-send');
            const chatBody = document.getElementById('chat-body');

            const toggleChat = () => {
                window.classList.toggle('active');
            };

            if(fab) fab.addEventListener('click', toggleChat);
            if(closeBtn) closeBtn.addEventListener('click', toggleChat);

            const addMessage = (text, type) => {
                const msgDiv = document.createElement('div');
                msgDiv.className = `chat-message message-${type}`;
                msgDiv.innerHTML = `
                    ${text}
                    <span class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                `;
                chatBody.appendChild(msgDiv);
                chatBody.scrollTop = chatBody.scrollHeight;
            };

            const handleSend = () => {
                const text = input.value.trim();
                if(!text) return;

                // User Message
                addMessage(text, 'user');
                input.value = '';

                // Mock Bot Response
                setTimeout(() => {
                    const responses = [
                        "Beden tablosuna g√∂z atabilirsiniz.",
                        "Kuma≈ü kalitesi %100 pamuktur.",
                        "Kargo s√ºreci 1-3 i≈ü g√ºn√ºd√ºr.",
                        "Stoklarƒ±mƒ±z g√ºncellenmektedir."
                    ];
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    addMessage(randomResponse, 'bot');
                }, 1000);
            };

            if(sendBtn) sendBtn.addEventListener('click', handleSend);
            if(input) input.addEventListener('keypress', (e) => {
                if(e.key === 'Enter') handleSend();
            });
        });
    </script>
</body>
</html>
